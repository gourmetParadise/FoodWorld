<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="style/bootstrap.min.css" rel="stylesheet">
    <link href="style/base.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

    <link href="style/person.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
        $(function () {
            var username = sessionStorage.getItem("username");

            $.ajax({
                type: 'GET',
                url: 'http://localhost:8088/user/' + username + '/userInfo',
                dataType: 'json',
                success: function (data) {
                    if (data.status === 10000) {
                        //插入数据
                        $("h1").html(username + "的厨房");
                        $("#userSex").html(data.userSex);
                        $("#userSign").html(data.userSign);
                        $("#nativePlace").html(data.nativePlace);
                        $("#userCareer").html(data.userCareer);
                        $("#imgShow").attr("src", data.userPhoto);//渲染用户头像
                        $("#addNum").html(data.addNum);
                        $("#addedNum").html(data.addedNum);
                        for (var i = 0; i < data.cooks.length; i++) {
                            $("#cooks").append(' <div class="col-sm-6 col-md-4">'
                                    + '<div class="thumbnail">'
                                    + '<a href="cookbookDetail.html?cookbookId=' + data.cooks[i].cookbookId+ '"><img id="food-img" src=' + data.cooks[i].cookImg + ' alt="..."/></a>'
                                    + '<div class="caption row">'
                                    + '<div class="col-md-6" id="food-name">' + data.cooks[i].cookName + '</div>'
                                    + '<div class="col-md-6" id="food-date">' + '不久前' + '</div>'
                                    + '</div>'
                                    + '<p id="food-description">' + data.cooks[i].cookDesc + '</p>'
                                    + '</div>'
                                    + '</div>'
                                    + '</div>')
                        }
                    }
                }
            });

            $(".works").on('click', function (event) {
                event.preventDefault();   //阻止默认事件
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:8088/user/' + username + '/userWorks',
                    dataType: 'json',
                    success: function (data) {
                        if (data.status === 10000) {
                            //插入数据

                        }
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            });
            $(".collects").on('click', function (event) {
                event.preventDefault();   //阻止默认事件
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost:8088/user/' + username + '/userCollects',
                    dataType: 'json',
                    success: function (data) {
                        if (data.status === 10000) {
                            //插入数据

                        }
                    },
                    error: function (err) {
                        console.log(err.message);
                    }
                })
            });

            $("input[type=file]").change(function (event) {
                console.log("is change?");
                var formData = new FormData($("#frmUploadFile")[0]);
                $.ajax({
                    url: 'http://localhost:8088/user/uploadPhoto',
                    type: 'POST',
                    data: formData,
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (data) {
                        if (data.status === 10000) {
                            event.target.value = "";//防止二次上传无效
                            $("#imgShow").attr('src', data.value);
                            $("#spanMessage").html("上传成功");
                        } else {
                            $("#spanMessage").html("上传失败");
                        }
                        console.log('imgUploader upload success, data:', data);
                    },
                    error: function (err) {
                        console.log(err.message);
                        $("#spanMessage").html("与服务器通信有误");
                    }
                });
            });
        });

    </script>
</head>
<body>
<div class="food-body user-info">
    <div class="row">
        <div class="col-md-3 avatar">
            <div>
                <img id="imgShow" src="images/init.png" class="img-thumbnail userImg"/>
            </div>
            <form class="form-horizontal" enctype='multipart/form-data' action='javascript:;' id="frmUploadFile">
                <input type="file" name="files"/>
                <span class="help-inline" id="spanMessage"></span>
            </form>
        </div>
        <div class="col-md-6">
            <ul>
                <li><h1 class="user-name"></h1></li>
                <li>
                    <span id="userSex" class="mr10 font12"></span>

                    <span id="nativePlace" class="mr10 font12"></span>

                    <span id="userCareer" class="mr10 font12"></span>
                </li>
                <li><p id="userSign" class="mt10"></p></li>
            </ul>
        </div>
        <div class="col-md-3 user-info-right">
            <div>
                <a href="personal-setting.html" class="font16">设置个人信息</a>
            </div>
            <div>
                关注
                <button id="addNum" class="bold font16"></button>

                被关注
                <button id="addedNum" class="bold font16"></button>
            </div>
            <a href="uploadbook.html" class="font16">上传菜谱</a>
        </div>
    </div>
    <!--菜谱等展示-->
    <div class="raw profile">
        <ul id="profileTab" class="nav nav-tabs">
            <li class="active">
                <a href="#cooks" data-toggle="tab">菜谱</a>
            </li>
            <li>
                <a href="#works" data-toggle="tab" class="works">作品</a>
            </li>
            <li>
                <a href="#collects" data-toggle="tab" class="collects">收藏</a>
            </li>
        </ul>

        <div id="profileTabContent" class="tab-content">
            <div class="row tab-pane fade in active" id="cooks" style="margin-top: 30px; !important;">

            </div>
            <div class="tab-pane fade" id="works">

            </div>
            <div class="tab-pane fade" id="collects">

            </div>
        </div>
    </div>
</div>
</body>
</html>